<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="./public/css/quill.core.css" rel="stylesheet">
    <link href="./public/css/index.css" rel="stylesheet">
    <script src="./public/js/quill.min.js"></script>
    <script src="./public/js/dsbridge.js"></script>
    <script src="./public/js/vconsole.min.js"></script>
</head>

<body>
    <!-- Create the editor container -->
    <div id="scrolling-container">
        <div id="editor"></div>
        <div class="test">
            <button onclick="quillObj.getContents()">提交按钮</button>
            <button onclick="quillObj.setImg()">插入图片</button>
            <button onclick="quillObj.setText()">插入文字</button>
            <button onclick="quillObj.getFocus()">获取焦点位置</button>
            <button onclick="quillObj.getLines()">获取焦点行数</button>
            <button onclick="quillObj.delText()">删除文字</button>
            <button onclick="quillObj.getLength()">获取文字长度</button>
        </div>
    </div>

    <!-- Initialize Quill editor -->
    <script>
        const isDebugger = true
        if(isDebugger){
            document.querySelector('.test').classList.remove('test');
        }
        var quill = new Quill('#editor', {
            scrollingContainer: 'scrolling-container',
            placeholder: '请输入正文',
        });
        const quillMethods = () => {
            // debugger
            const setImg = () => {
                const index = getFocus();
                console.log(index);
                setText(index, "/n");
                quill.insertEmbed(
                    index + 1,
                    "image",
                    "https://placem.at/things?w=50&random=1"
                );
                console.log(getFocus());
            };
            const setText = (index, text) => {
                console.log('==========in')
                quill.insertText(index, text);
            };
            const getFocus = () => {
                return quill.getSelection().index;
            };
            const getLines = () => {
                console.log(quill.getLines(quill.getFocus()));
                return quill.getLines(quill.getFocus());
            }
            const getLength = () => {
                alert(quill.getLength())
                return quill.getLength()
            }
            const delText = () => {
                quill.deleteText(3, 3)
            }
            // production
            const getContents = () => {
                console.log(quill.getContents());
                console.log(quill.getText());
            };
            return isDebugger ? new VConsole() && {
                setImg,
                setText,
                getFocus,
                getLines,
                getContents,
                delText,
                getLength
            } : { getContents }
        }

        const quillObj = quillMethods()

        // bridge
        dsBridge.register('getContents', quillObj.getContents)
    </script>

</body>

</html>